<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Transcription Studio</title>
  <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
  <div id="app">
    <!-- Top Bar -->
    <header id="topbar">
      <div class="topbar-left">
        <h1>Transcription Studio</h1>
      </div>
      <div class="topbar-center">
        <div class="button-group">
          <button id="record-btn" class="btn" disabled>Start Recording</button>
          <button id="clear-btn" class="btn secondary" disabled>Clear</button>
          <button id="copy-btn" class="btn secondary" disabled>Copy</button>
        </div>
        <div id="audio-visualizer"></div>
        <div id="recording-status"></div>
      </div>
      <div class="topbar-right">
        <div class="speaker-config">
          <label for="num-speakers">Speakers:</label>
          <select id="num-speakers">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>
        </div>
      </div>
    </header>

    <!-- Main Content Grid -->
    <main id="main-content">
      <!-- Transcript Workspace (left) -->
      <section id="transcript-section" class="workspace">
        <div id="transcript-container">
          <p class="placeholder">Transcript will appear here when you start recording...</p>
        </div>
      </section>

      <!-- Debug Sidebar (right) -->
      <aside id="sidebar">
        <!-- Speaker Visualization Panel -->
        <div class="sidebar-panel" id="panel-speaker-plot" data-default-expanded="true">
          <div class="panel-header" data-panel="speaker-plot">
            <span class="panel-chevron">&#9662;</span>
            <h3>Speaker Embedding Space</h3>
          </div>
          <div class="panel-content">
            <div class="viz-info">Dots closer together = more similar voices</div>
            <canvas id="speaker-canvas"></canvas>
          </div>
        </div>

        <!-- Chunk Queue Panel -->
        <div class="sidebar-panel" id="panel-chunk-queue" data-default-expanded="true">
          <div class="panel-header" data-panel="chunk-queue">
            <span class="panel-chevron">&#9662;</span>
            <h3>Chunk Queue</h3>
          </div>
          <div class="panel-content">
            <div id="chunk-queue-viz">
              <div class="chunk-slots">
                <div class="chunk-slot" data-slot="0"></div>
                <div class="chunk-slot" data-slot="1"></div>
                <div class="chunk-slot" data-slot="2"></div>
                <div class="chunk-slot" data-slot="3"></div>
                <div class="chunk-slot" data-slot="4"></div>
              </div>
              <div class="chunk-stats">
                <span id="chunk-processing">Idle</span>
                <span id="chunk-counts"></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Phrase Stats Panel -->
        <div class="sidebar-panel" id="panel-phrase-stats" data-default-expanded="true">
          <div class="panel-header" data-panel="phrase-stats">
            <span class="panel-chevron">&#9662;</span>
            <h3>Last Phrase</h3>
          </div>
          <div class="panel-content">
            <div id="phrase-stats">
              <div class="phrase-text-preview" id="phrase-preview">No phrases yet</div>
              <div class="phrase-details" id="phrase-details">
                <div class="detail-row">
                  <span class="detail-label">Speaker:</span>
                  <span class="detail-value" id="phrase-speaker">-</span>
                </div>
                <div class="detail-row indent">
                  <span class="detail-label">Similarity:</span>
                  <span class="detail-value" id="phrase-similarity">-</span>
                </div>
                <div class="detail-row indent">
                  <span class="detail-label">Runner-up:</span>
                  <span class="detail-value" id="phrase-runner-up">-</span>
                </div>
                <div class="detail-row indent">
                  <span class="detail-label">Margin:</span>
                  <span class="detail-value" id="phrase-margin">-</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Duration:</span>
                  <span class="detail-value" id="phrase-duration">-</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Type:</span>
                  <span class="detail-value" id="phrase-type">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Speaker Enrollment Panel -->
        <section id="enrollment-section" class="sidebar-panel" data-default-expanded="false">
          <div class="panel-header" data-panel="enrollment">
            <span class="panel-chevron">&#9656;</span>
            <h3>Speaker Enrollment <span class="optional-badge">Optional</span></h3>
          </div>
          <div class="panel-content collapsed">
            <!-- Intro state (before enrollment starts) -->
            <div id="enrollment-intro">
              <p>Record your voice to help identify you in conversations.</p>
              <div class="enroll-name-row">
                <label for="enroll-name">Name:</label>
                <input type="text" id="enroll-name" placeholder="e.g., Jake" maxlength="20">
              </div>
              <div class="enroll-actions">
                <button id="enroll-start-btn" class="btn primary small" disabled>Start Enrollment</button>
                <button id="enroll-skip-btn" class="btn secondary small">Skip</button>
              </div>
            </div>

            <!-- Recording state (during enrollment) -->
            <div id="enrollment-recording" class="hidden">
              <p class="enroll-instruction">Read aloud:</p>
              <blockquote id="enroll-sentence"></blockquote>

              <div class="enroll-controls">
                <button id="enroll-record-btn" class="btn primary small">Record</button>
                <button id="enroll-skip-sentence-btn" class="btn secondary small">Skip</button>
              </div>

              <div id="enroll-progress">
                <span id="enroll-progress-text">Sample 0 of 6</span>
                <div class="progress-dots" id="enroll-dots"></div>
              </div>

              <div class="enroll-actions">
                <button id="enroll-finish-btn" class="btn primary small" disabled>Finish</button>
                <button id="enroll-cancel-btn" class="btn secondary small">Cancel</button>
              </div>
            </div>

            <!-- Complete state (after enrollment) -->
            <div id="enrollment-complete" class="hidden">
              <div class="enrolled-header">
                <span id="enrolled-count" class="enrolled-count">0 speakers enrolled</span>
                <button id="add-speaker-btn" class="btn secondary small" disabled>+ Add</button>
              </div>
              <div id="enrolled-items"></div>
              <button id="clear-all-enrollments-btn" class="btn secondary small">Clear All</button>
            </div>

            <div id="enroll-status"></div>
          </div>
        </section>

        <!-- Model Status Panel -->
        <div class="sidebar-panel" id="panel-model-status" data-default-expanded="false">
          <div class="panel-header" data-panel="model-status">
            <span class="panel-chevron">&#9656;</span>
            <h3>Model Status</h3>
          </div>
          <div class="panel-content collapsed" id="model-status">
            <div id="loading-message">Models will auto-load...</div>
            <button id="load-models-btn" class="btn primary small hidden">Reload Models</button>
            <div id="progress-container"></div>
            <div id="device-info"></div>
          </div>
        </div>
      </aside>
    </main>

    <!-- Status Bar -->
    <footer id="status-bar">
      <div class="status-indicator">
        <span class="status-dot" id="status-dot"></span>
        <span id="status-text">Ready</span>
      </div>
      <div class="status-metrics">
        <div class="metric">
          <span class="metric-label">ASR:</span>
          <span class="metric-value" id="metric-asr">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">Embed:</span>
          <span class="metric-value" id="metric-embed">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">Total:</span>
          <span class="metric-value" id="metric-total">-</span>
        </div>
      </div>
      <div class="status-buffer">
        <span class="metric-label">Buffer:</span>
        <div class="buffer-bar">
          <div class="buffer-fill" id="buffer-fill"></div>
        </div>
        <span class="metric-value" id="buffer-percent">0%</span>
      </div>
    </footer>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
