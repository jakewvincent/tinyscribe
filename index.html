<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Transcription Studio</title>
  <link rel="stylesheet" href="/src/styles.css">
</head>
<body>
  <div id="app">
    <!-- Top Bar -->
    <header id="topbar">
      <div class="topbar-left">
        <h1>Transcription Studio</h1>
      </div>
      <div class="topbar-center">
        <div class="button-group">
          <button id="record-btn" class="btn" disabled>Start Recording</button>
          <button id="clear-btn" class="btn secondary" disabled>Clear</button>
        </div>
        <div id="audio-visualizer"></div>
        <div id="recording-status"></div>
      </div>
      <div class="topbar-right">
        <div class="mic-config">
          <label for="mic-select">Mic:</label>
          <select id="mic-select">
            <option value="">Default</option>
          </select>
        </div>
        <div class="speaker-config">
          <label for="num-speakers">Speakers:</label>
          <select id="num-speakers">
            <option value="1">1</option>
            <option value="2" selected>2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
          </select>
        </div>
      </div>
    </header>

    <!-- Main Content Grid -->
    <main id="main-content">
      <!-- Transcript Workspace (left) -->
      <section id="transcript-section" class="workspace">
        <!-- Raw Chunks Panel (top 1/3) -->
        <div id="raw-chunks-panel">
          <div class="panel-header-inline">
            <h3>Raw Whisper Output</h3>
            <span class="panel-subtitle">Word-by-word transcription before processing</span>
            <button id="export-raw-btn" class="btn secondary small" disabled>Export</button>
          </div>
          <div id="raw-chunks-container">
            <p class="placeholder">Raw chunk data will appear here...</p>
          </div>
        </div>

        <!-- Divider -->
        <div class="workspace-divider"></div>

        <!-- Processed Transcript (bottom 2/3) -->
        <div id="processed-panel">
          <div class="panel-header-inline">
            <h3>Processed Transcript</h3>
            <span class="panel-subtitle">Grouped into phrases with speaker assignment</span>
            <button id="copy-btn" class="btn secondary small" disabled>Copy</button>
            <button id="export-transcript-btn" class="btn secondary small" disabled>Export</button>
          </div>
          <div id="transcript-container">
            <p class="placeholder">Transcript will appear here when you start recording...</p>
          </div>
        </div>
      </section>

      <!-- Debug Sidebar (right) -->
      <aside id="sidebar">
        <!-- Phrase Stats Panel -->
        <div class="sidebar-panel" id="panel-phrase-stats" data-default-expanded="true">
          <div class="panel-header" data-panel="phrase-stats">
            <span class="panel-chevron">&#9662;</span>
            <h3>Last Phrase</h3>
          </div>
          <div class="panel-content">
            <div id="phrase-stats">
              <div class="phrase-text-preview" id="phrase-preview">No phrases yet</div>
              <div class="phrase-details" id="phrase-details">
                <div class="detail-row">
                  <span class="detail-label">Speaker:</span>
                  <span class="detail-value" id="phrase-speaker">-</span>
                </div>
                <div class="detail-row indent">
                  <span class="detail-label">Similarity:</span>
                  <span class="detail-value" id="phrase-similarity">-</span>
                </div>
                <div class="detail-row indent">
                  <span class="detail-label">Runner-up:</span>
                  <span class="detail-value" id="phrase-runner-up">-</span>
                </div>
                <div class="detail-row indent">
                  <span class="detail-label">Margin:</span>
                  <span class="detail-value" id="phrase-margin">-</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Duration:</span>
                  <span class="detail-value" id="phrase-duration">-</span>
                </div>
                <div class="detail-row">
                  <span class="detail-label">Type:</span>
                  <span class="detail-value" id="phrase-type">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Speaker Enrollment Panel -->
        <section id="enrollment-section" class="sidebar-panel" data-default-expanded="true">
          <div class="panel-header" data-panel="enrollment">
            <span class="panel-chevron">&#9662;</span>
            <h3>Speaker Enrollment <span class="optional-badge">Optional</span></h3>
          </div>
          <div class="panel-content">
            <!-- Intro state (before enrollment starts) -->
            <div id="enrollment-intro">
              <p>Record your voice to help identify you in conversations.</p>
              <div class="enroll-name-row">
                <label for="enroll-name">Name:</label>
                <input type="text" id="enroll-name" placeholder="e.g., Jake" maxlength="20">
              </div>
              <div class="enroll-actions">
                <button id="enroll-start-btn" class="btn primary small" disabled>Start Enrollment</button>
                <button id="enroll-skip-btn" class="btn secondary small">Skip</button>
              </div>
            </div>

            <!-- Recording state (during enrollment) -->
            <div id="enrollment-recording" class="hidden">
              <p class="enroll-instruction">Read aloud (click dots to select or re-record):</p>
              <blockquote id="enroll-sentence"></blockquote>

              <div class="enroll-controls">
                <button id="enroll-record-btn" class="btn primary small">Record</button>
              </div>

              <div id="enroll-progress">
                <span id="enroll-progress-text">0 of 3 recorded</span>
                <div class="progress-dots" id="enroll-dots"></div>
              </div>

              <div class="enroll-actions">
                <button id="enroll-finish-btn" class="btn primary small" disabled>Finish</button>
                <button id="enroll-cancel-btn" class="btn secondary small">Cancel</button>
              </div>
            </div>

            <!-- Complete state (after enrollment) -->
            <div id="enrollment-complete" class="hidden">
              <div class="enrolled-header">
                <span id="enrolled-count" class="enrolled-count">0 speakers enrolled</span>
                <button id="add-speaker-btn" class="btn secondary small" disabled>+ Add</button>
              </div>
              <div id="enrolled-items"></div>
              <button id="clear-all-enrollments-btn" class="btn secondary small">Clear All</button>
            </div>

            <div id="enroll-status"></div>

            <!-- Speaker Embedding Visualization -->
            <div class="enrollment-viz-section">
              <div class="viz-divider"></div>
              <div class="viz-header">Speaker Embedding Space</div>
              <div class="viz-info">Dots closer together = more similar voices</div>
              <canvas id="speaker-canvas"></canvas>
            </div>
          </div>
        </section>

        <!-- Model Status Panel -->
        <div class="sidebar-panel" id="panel-model-status" data-default-expanded="false">
          <div class="panel-header" data-panel="model-status">
            <span class="panel-chevron">&#9656;</span>
            <h3>Model Status</h3>
          </div>
          <div class="panel-content collapsed" id="model-status">
            <div id="loading-message">Models will auto-load...</div>
            <button id="load-models-btn" class="btn primary small hidden">Reload Models</button>
            <div id="progress-container"></div>
            <div id="device-info"></div>
          </div>
        </div>
      </aside>
    </main>

    <!-- Status Bar -->
    <footer id="status-bar">
      <div class="status-indicator">
        <span class="status-dot" id="status-dot"></span>
        <span id="status-text">Ready</span>
      </div>
      <div class="status-metrics">
        <div class="metric">
          <span class="metric-label">ASR:</span>
          <span class="metric-value" id="metric-asr">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">Embed:</span>
          <span class="metric-value" id="metric-embed">-</span>
        </div>
        <div class="metric">
          <span class="metric-label">Total:</span>
          <span class="metric-value" id="metric-total">-</span>
        </div>
      </div>
      <div class="status-chunks">
        <div class="chunk-slots">
          <div class="chunk-slot" data-slot="0"></div>
          <div class="chunk-slot" data-slot="1"></div>
          <div class="chunk-slot" data-slot="2"></div>
          <div class="chunk-slot" data-slot="3"></div>
          <div class="chunk-slot" data-slot="4"></div>
        </div>
        <span class="chunk-status" id="chunk-processing">Idle</span>
      </div>
      <div class="status-buffer">
        <span class="metric-label">Buffer:</span>
        <div class="buffer-bar">
          <div class="buffer-fill" id="buffer-fill"></div>
        </div>
        <span class="metric-value" id="buffer-percent">0%</span>
      </div>
    </footer>

    <!-- Enrollment Modal -->
    <div id="enrollment-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-content" role="document">
        <!-- Header -->
        <div class="modal-header">
          <h2 id="modal-title">Speaker Enrollment</h2>
          <span id="modal-speaker-name" class="modal-speaker-name"></span>
        </div>

        <!-- Passage -->
        <div class="modal-passage-section">
          <div class="passage-label">Read aloud:</div>
          <blockquote id="modal-passage-text" class="modal-passage-text"></blockquote>
        </div>

        <!-- Feedback (volume bar, VAD indicator, timer) -->
        <div class="modal-feedback-section">
          <div class="modal-volume-wrapper">
            <label class="feedback-label">Mic Level</label>
            <div class="modal-volume-bar">
              <div id="modal-volume-fill" class="volume-fill"></div>
            </div>
          </div>
          <div class="modal-vad-wrapper">
            <label class="feedback-label">Speech</label>
            <div id="modal-vad-indicator" class="vad-indicator listening">
              <span class="vad-dot"></span>
              <span id="modal-vad-text" class="vad-text">Listening...</span>
            </div>
          </div>
          <div class="modal-timer-wrapper">
            <label class="feedback-label">Duration</label>
            <span id="modal-recording-timer" class="recording-timer">0:00</span>
          </div>
        </div>

        <!-- Progress dots -->
        <div class="modal-progress-section">
          <span class="progress-label">Passages:</span>
          <div id="modal-progress-dots" class="modal-progress-dots"></div>
        </div>

        <!-- Status -->
        <div id="modal-status" class="modal-status"></div>

        <!-- Actions -->
        <div class="modal-actions">
          <div class="modal-record-group">
            <button id="modal-record-btn" class="btn primary">Record</button>
            <button id="modal-upload-btn" class="btn secondary">Upload</button>
            <input type="file" id="modal-file-input" accept="audio/*" class="hidden">
          </div>
          <button id="modal-finish-btn" class="btn" disabled>Finish</button>
          <button id="modal-cancel-btn" class="btn secondary">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
